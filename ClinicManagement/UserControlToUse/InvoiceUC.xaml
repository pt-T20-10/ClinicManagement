<UserControl x:Class="ClinicManagement.UserControlToUse.InvoiceUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ClinicManagement.UserControlToUse"
             xmlns:conver="clr-namespace:ClinicManagement.Converter"
             mc:Ignorable="d" 
             xmlns:sub="clr-namespace:ClinicManagement.SubWindow"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             TextElement.Foreground="{DynamicResource MaterialDesignBody}"
             TextElement.FontWeight="Regular"
             TextElement.FontSize="13"
             TextOptions.TextFormattingMode="Ideal"
             TextOptions.TextRenderingMode="Auto"
             Background="{DynamicResource MaterialDesignPaper}"
             FontFamily="{DynamicResource MaterialDesignFont}"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             Name="InvoiceUc">
     
    <!-- Tạo UC Resouces để sử dụng Converter hổ trỗ UI-->
    <UserControl.Resources>
        <conver:StringTrimmingConverter x:Key="StringTrimmingConverter"/>
        <conver:InvertBooleanConverter x:Key="InvertBooleanConverter"/>
    </UserControl.Resources>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding LoadedUCCommand}" 
                                CommandParameter="{Binding ElementName=InvoiceUc}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <!--ContextMenu cho nút làm mới-->
    <UserControl.ContextMenu>
        <ContextMenu>
            <MenuItem Header="🔄 Làm mới" 
                  Command="{Binding ResetFiltersCommand}"
                  FontWeight="Bold"/>
        </ContextMenu>
    </UserControl.ContextMenu>

    <!-- Main Card-->
    <materialDesign:Card Margin="10">
                
        <!--Main Grid có 3 Row-->
                <Grid>
                    <Grid.RowDefinitions>
                       <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Row 0 - Row của bộ lọc -->
                    <materialDesign:Card Grid.Row="0" Margin="8" Padding="16" UniformCornerRadius="8">
                        
                        <!--Grid có có 2 Row -->
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Tiêu đề -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                                <materialDesign:PackIcon Kind="InvoiceOutline" Width="24" Height="24" VerticalAlignment="Center"/>
                                <TextBlock Text="DANH SÁCH HÓA ĐƠN" FontSize="24" FontWeight="Bold" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Bộ lọc -->
                            <!--Dùng 6 Column -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                
                               
                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">

                            <!-- Phần để chọn móc thời gian để lọc hóa đơn
                                 Ngày bắt đầu Binding từ StartDate
                                 Ngày kết thúc Binding từ EndDate 
                                 Mắc định là sẽ chọn từ ngày hiện tại đến 1 tháng trước
                                 
                                  UpdateSourceTrigger mặc định của DatePicker là LostFocus
                                  nên ở đây phải gán thành PropertyChanged để truyền xuống VM lọc được ngay sau khi chọn xong giờ
                             -->

                            <TextBlock Text="Từ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                    <DatePicker 
                                        SelectedDate="{Binding StartDate, UpdateSourceTrigger=PropertyChanged}" 
                                        Width="140"
                                        Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                        materialDesign:HintAssist.Hint="Ngày bắt đầu"/>
                                    <TextBlock Text="đến:" VerticalAlignment="Center" Margin="8,0,8,0"/>
                                    
                                    <DatePicker 
                                        SelectedDate="{Binding EndDate, UpdateSourceTrigger=PropertyChanged}" 
                                        Width="140"
                                        Style="{StaticResource MaterialDesignOutlinedDatePicker}"
                                        materialDesign:HintAssist.Hint="Ngày kết thúc"/>
                                    
                                </StackPanel>

                                <!-- ComboBox để chọn lọc theo Trạng thái hóa đơn
                                     Vì không có Table trạng thái riêng trong database nên 
                                     trong VM tạo 1 class Status Item dùng chung,
                                     Và dùng ObservableCollection <InvoiceStatusList> để Binding.
                                     3 trạng thái mặc định là: Đã thanh toán, chưa thanh toán, và "" là Tất cả 
                                    
                                      SelectedItem sẽ Binding đến SelectedInvoiceStatus để từ đó lấy được Status rồi 
                                      truyền vào phương thức lọc
                                
                                        ComboBox.SelectedItem thì UpdateSourceTrigger mặc định là PropertyChanged 
                                        nên không gán thêm ở Binding 
                                -->
                                <ComboBox 
                                    Grid.Column="1" 
                                    Width="180" 
                                    ItemsSource="{Binding InvoiceStatusList}"             
                                    SelectedItem="{Binding SelectedInvoiceStatus}"
                                    DisplayMemberPath="DisplayName"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    materialDesign:HintAssist.Hint="Trạng thái thanh toán"
                                    Margin="0,0,16,0" >
                                    </ComboBox>

                                <!-- ComboBox để chọn lọc theo Loại hóa đơn
                                     Vì không có Table loại hóa đơn riêng trong database nên 
                                     trong VM tạo 1 class InvoiceType Item dùng chung,
                                     Và dùng ObservableCollection <InvoiceTypeList> để Binding.
                                     3 loại hóa đơn mặc định là: Khám bệnh, Bán thuốc, Khám và bán thuốc
                                
                                     SelectedItem sẽ Binding đến SelectedInvoiceType để từ đó lấy được InvoiceType rồi
                                      truyền vào phương thức lọc  
                                -->
                                <ComboBox 
                                    Grid.Column="2" 
                                    Width="180" 
                                    ItemsSource="{Binding InvoiceTypeList}"
                                    SelectedItem="{Binding SelectedInvoiceType}"
                                    DisplayMemberPath="DisplayName"
                                    Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                    materialDesign:HintAssist.Hint="Loại hóa đơn"
                                    Margin="0,0,16,0"/>

                                <!-- Search Box nhập tên BN, mã BH, SĐT để thực hiện lọc, 
                                     lọc gần đúng kiểm tra từng ký tự nhập vào có nằm trong tên, mã BH, SĐT hay không
                                -->
                                <TextBox 
                                    Grid.Column="3"
                                    Width="300"
                                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                    materialDesign:HintAssist.Hint="Tìm theo tên BN, mã BH, SĐT..."
                                    Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                    Margin="0,0,16,0">
                                    <TextBox.InputBindings>
                                        <KeyBinding Key="Return" Command="{Binding SearchCommand}"/>
                                    </TextBox.InputBindings>
                                </TextBox>

                                <!-- Search Button để thực hiện SearchCommand Lọc theo nhiều tiêu chí
                                     Nhưng phương thức lọc bên dưới đã được tự động nên nhấn nút cũng được hoặc không
                                -->
                                
                                <StackPanel Grid.Column="5" Orientation="Horizontal">
                                    <Button
                                        Command="{Binding SearchCommand}"
                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                        Margin="0,0,8,0"
                                        Width="120">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Search" Margin="0,0,8,0"/>
                                            <TextBlock Text="Tìm kiếm"/>
                                        </StackPanel>
                                    </Button>
                                    
                                    <!-- Nút đặt lại để đặt lại các tiêu chí lọc về trạng thái ban đâu-->
                                    <Button
                                        Command="{Binding ResetFiltersCommand}"
                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                        Width="100">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon Kind="Refresh" Margin="0,0,8,0"/>
                                            <TextBlock Text="Đặt lại"/>
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </materialDesign:Card>
                    

                    <!-- Datagrid hiện thị danh sách hóa đơn
                        ItemSource Binding đến ObservableCollection<Invoice> Invoices trong VM 
                        SelectedItem Binding đến SelectedInvoice kiểu Invoice trong VM để lấy thông tin chi tiết hóa đơn 
                        đê truyền vào các Command xử lý sự kiện mở các trang như chi tiết hóa đơn, thanh toán, in hóa đơn...
                    
                        AutoGenerateColumns="False" để không tự động sinh cột mà sẽ tự định nghĩa các cột cần thiết
                         CanUserSortColumns="True" để có thể sắp xếp các cột theo thứ tự tăng dần hoặc giảm dần
                         CanUserResizeColumns="True" để có thể thay đổi kích thước các cột
                         CanUserReorderColumns="True" để có thể kéo thả các cột để thay đổi vị trí
                         VerticalScrollBarVisibility="Auto" thanh cuộn dọc xuất hiện khi cần thiết
                         HorizontalScrollBarVisibility="Auto" thanh cuộn ngang xuất hiện khi cần thiết
                    -->
                    <materialDesign:Card Grid.Row="1" Margin="8" UniformCornerRadius="8">
                        <Grid>
                            <DataGrid 
                                ItemsSource="{Binding Invoices}" 
                                SelectedItem="{Binding SelectedInvoice}"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                CanUserSortColumns="True"
                                CanUserResizeColumns="True"
                                CanUserReorderColumns="True"
                                RowHeight="80"
                                HeadersVisibility="Column"
                                BorderThickness="0"
                                Background="White"
                                VerticalScrollBarVisibility="Visible"
                                HorizontalScrollBarVisibility="Visible"
                                Margin="0,0,0,8">

                        <DataGrid.Resources>
                            <Style TargetType="DataGridRow">
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                                <Setter Property="Margin" Value="0,2"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#F5F5F5"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#E3F2FD"/>
                                        <Setter Property="Foreground" Value="#1565C0"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#ECEFF1"/>
                                <Setter Property="Foreground" Value="#37474F"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Height" Value="40"/>
                                <Setter Property="Padding" Value="8,0"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                <Setter Property="VerticalContentAlignment" Value="Center"/>
                            </Style>
                            <Style x:Key="CenteredCellStyle" TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="TextWrapping" Value="Wrap"/>
                                <Setter Property="Padding" Value="4,0"/>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                           
                            <!-- TextColumn Mã hóa đơn Binding từ InvoiceId  -->
                            <DataGridTextColumn Header="Mã hóa đơn" Binding="{Binding InvoiceId}" Width="80"
                                                 ElementStyle="{StaticResource CenteredCellStyle}"
                                                        />

                            <DataGridTextColumn Header="Kê thuốc" Binding="{Binding StaffPrescriber.FullName}" Width="120" ElementStyle="{StaticResource CenteredCellStyle}"/>
                            <DataGridTextColumn Header="Xác nhận" Binding="{Binding StaffCashier.FullName}" Width="120" ElementStyle="{StaticResource CenteredCellStyle}"/>
                            <!-- TextColumn Ngày lập InvoiceDate 
                                    tringFormat='{}{0:dd/MM/yyyy} để lấy định dạng ngày tháng là dd/MM/yyyy, ngày tháng năm không lấy giờ 
                                    -->
                            
                            <DataGridTextColumn Header="Ngày lập" Binding="{Binding InvoiceDate, StringFormat='{}{0:dd/MM/yyyy}'}" Width="120" ElementStyle="{StaticResource CenteredCellStyle}"/>

                            <!--  Text Column Tên khách hàng Binding từ FullName của Patient 
                                            Cho phép xuống dòng nếu cần thiết
                                    -->
                            <DataGridTextColumn Header="Khách hàng" Binding="{Binding Patient.FullName}" Width="150" ElementStyle="{StaticResource CenteredCellStyle}"/>

                            <!-- Text Column SĐT Binding từ Phone của Patient -->
                            <DataGridTextColumn Header="SĐT" Binding="{Binding Patient.Phone}" Width="115" ElementStyle="{StaticResource CenteredCellStyle}" />

                       
                           <!--    Text Column Tổng tiền Binding từ TotalAmount
                                    StringFormat='{}{0:N0} VNĐ' để định dạng số tiền là số nguyên không có dấu phẩy và có đuôi VNĐ
                                    
                                    -->
                                    <DataGridTextColumn Header="Tổng tiền" Binding="{Binding TotalAmount, StringFormat='{}{0:N0} VNĐ'}" Width="130">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Left"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <!-- Loại hóa đơn
                                        Sử dụng DataGridTemplateColumn để tạo kiểu hiển thị đặc biệt cho loại hóa đơn
                                        Với Border và TextBlock để hiển thị màu sắc và kiểu dáng khác nhau tùy theo loại hóa đơn
                                      -->
                                    <DataGridTemplateColumn Header="Loại hóa đơn" Width="155">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                        <Border Height="30"  CornerRadius="6" Padding="8,4" HorizontalAlignment="Center">
                                                    <Border.Style>
                                                   <!-- 
                                                        DataTrigger sẽ kiểm tra giá trị của InvoiceType và áp dụng các thuộc tính được set trong setter tùy theo loại hóa đơn cho Border
                                                        Sử dụng Converter StringTrimmingConverter để loại bỏ khoảng trắng thừa trong giá trị Binding đảm bảo nhận đúng giá trị
                                                        Converter đã được định nghĩa trong UserControl.Resources
                                                        ConverterStrimmingConverter sẽ lấy giá trị được Binding và loại bỏ khoảng trắng thừa trước và sau giá trị đó rồi trả về giá trị đã được trim
                                                    -->
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding InvoiceType, Converter={StaticResource StringTrimmingConverter}}" Value="Khám bệnh">
                                                                    <Setter Property="Background" Value="#E3F2FD"/>
                                                                    <Setter Property="BorderBrush" Value="#2196F3"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding InvoiceType, Converter={StaticResource StringTrimmingConverter}}" Value="Bán thuốc">
                                                                    <Setter Property="Background" Value="#E8F5E9"/>
                                                                    <Setter Property="BorderBrush" Value="#43A047"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding InvoiceType, Converter={StaticResource StringTrimmingConverter}}" Value="Khám và bán thuốc">
                                                                    <Setter Property="Background" Value="#F3E5F5"/>
                                                                    <Setter Property="BorderBrush" Value="#9C27B0"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <!-- Text Block để hiển thị Loại hóa đơn và cũng sử dụng Converter như trên -->
                                            <ScrollViewer  HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                                                <TextBlock  Padding="0" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="12" TextAlignment="Center" TextWrapping="Wrap">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding InvoiceType, Converter={StaticResource StringTrimmingConverter}}" Value="Khám bệnh">
                                                                    <Setter Property="Text" Value="Khám bệnh"/>
                                                                    <Setter Property="Foreground" Value="#1565C0"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding InvoiceType , Converter={StaticResource StringTrimmingConverter}}" Value="Bán thuốc">
                                                                    <Setter Property="Text" Value="Bán thuốc"/>
                                                                    <Setter Property="Foreground" Value="#2E7D32"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding InvoiceType, Converter={StaticResource StringTrimmingConverter}}" Value="Khám và bán thuốc">
                                                                    <Setter Property="Text" Value="Khám và bán thuốc"/>
                                                                    <Setter Property="Foreground" Value="#7B1FA2"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </ScrollViewer>
                                        </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                            <!-- TemplateColumn Trạng thái để hiển trị trạng thái của hóa đơn -->
                                    <DataGridTemplateColumn Header="Trạng thái" Width="135">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Border CornerRadius="6" Padding="8,4" VerticalAlignment="Center" HorizontalAlignment="Center">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Đã thanh toán">
                                                                    <Setter Property="Background" Value="#E8F5E8"/>
                                                                    <Setter Property="BorderBrush" Value="#4CAF50"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Chưa thanh toán">
                                                                    <Setter Property="Background" Value="#FFF3E0"/>
                                                                    <Setter Property="BorderBrush" Value="#FF9800"/>
                                                                    <Setter Property="BorderThickness" Value="1"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock HorizontalAlignment="Center" FontWeight="SemiBold" FontSize="12" TextAlignment="Center">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Đã thanh toán">
                                                                        <Setter Property="Text" Value="Đã thanh toán"/>
                                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Chưa thanh toán">
                                                                        <Setter Property="Text" Value="Chưa thanh toán"/>
                                                                        <Setter Property="Foreground" Value="#EF6C00"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Border>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>

                                    <!-- TextCoulumn Ghi chú hiển thị ghi chú của hóa đơn  -->
                                    <DataGridTextColumn Header="Ghi chú" Binding="{Binding Notes}" Width="285">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="TextWrapping" Value="Wrap"/>
                                                <Setter Property="VerticalAlignment" Value="Center"/>
                                                 <Setter Property="Padding" Value="0"/>
                                    </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>

                                    <!-- Các nút chức năng cho mỗi hóa đơn -->
                                    <DataGridTemplateColumn  Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                    <!-- 
                                                        Nút xem chi tiết hóa đơn tất cả các hóa đơn đều có 
                                                        
                                                    Button này nằm trong một cell của DataGrid, nhưng command lại được định nghĩa ở ViewModel của DataGrid (không phải ở item level),
                                                    nên cần phải "nhảy lên" DataGrid cha để lấy command.
                                                    Sử dụng RelativeSource để tìm kiếm DataGrid cha gần nhất
                                                    AncestorType={x:Type DataGrid} có nghĩa là tìm lên cây visual để tìm control có kiểu DataGrid
                                                    Path=DataContext.ViewInvoiceDetailsCommand trỏ đến property ViewInvoiceDetailsCommand trong DataContext của DataGrid đó
                                                    CommandParameter là tham số được truyền cho command khi execute
                                                    {Binding} sẽ truyền toàn bộ thông tin của dòng hiện tại cho Command xử lí ở VM
                                                    -->
                                                    <Button 
                                                        Command="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=DataContext.ViewInvoiceDetailsCommand}" 
                                                        CommandParameter="{Binding}"
                                                        Style="{StaticResource MaterialDesignOutlinedButton}"
                                                        Margin="0,0,8,0" Width="40" Height="32" Padding="2"
                                                        ToolTip="Xem chi tiết"
                                                        >
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="FileDocumentOutline" />

                                                        </StackPanel>
                                                    </Button>


                                            <!-- Nút thanh toán với strigger set Visibility theo Status của hóa đơn 
                                                    Nếu đã thanh toán thì nút này sẽ ẩn đi 
                                                    với Value="Collapsed" để ẩn nút và không chiếm chổ trong layout
                                                    
                                                    -->
                                                    <Button 
                                                        Command="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=DataContext.ProcessPaymentCommand}" 
                                                        CommandParameter="{Binding}"
                                                        ToolTip="Thanh toán"
                                                        Background="#4CAF50"
                                                        BorderBrush="#388E3C"
                                                        Width="40" Height="32"
                                                        Padding="2"
                                                        Margin="0,0,8,0">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Status}" Value="Đã thanh toán">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="CreditCardOutline" />

                                                        </StackPanel>
                                                    </Button>

                                                    <!-- Nút bán thuốc cho hóa đơn có loại là  "Khám và bán thuốc" 
                                                         Vì logic xử lí sẽ là khi khám bệnh lưu hồ sơ bệnh án cho bệnh nhân 
                                                        cũng như tạo 1 hóa đơn chưa thanh và chi tiết hóa đơn cho bệnh nhân đó
                                                        và nếu có đơn thuốc trong hồ sơ bệnh án thì hóa đơn sẽ là "khám và bán thuốc" 
                                                        thì sẽ thực hiện thêm việc bán thuốc rồi mới thanh toán
                                                    -->
                                                    <Button 
                                                  
                                                        Command="{Binding RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}, Path=DataContext.SellMedicineCommand}" 
                                                        CommandParameter="{Binding}"
                                                        ToolTip="Bán thuốc"    
                                                        Background="#3F51B5"
                                                        BorderBrush="#303F9F"
                                                        Padding="2"
                                                        Width="40" Height="32">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding InvoiceType}" Value="Khám bệnh">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                        
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding InvoiceType}" Value="Khám bệnh">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                        </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon Kind="Pill"/>
                                                            
                                                        </StackPanel>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>

                            </DataGrid>
                        </Grid>
                    </materialDesign:Card>
                    

                    <!-- Phần phân trang và chuyển trang  -->
                    <Grid Grid.Row="2" Margin="8,0,8,8">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- ComboBox để chọn số lượng hóa đơn hiển thị của 1 trang như 10, 50, 100 -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="Hiển thị:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox 
                                Width="80"
                                ItemsSource="{Binding ItemsPerPageOptions}"
                                SelectedItem="{Binding SelectedItemsPerPage}"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"/>
                        </StackPanel>

                        <!-- Phần để chuyển trang và hiển thị trang hiện tại  -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <!-- Nút chuyển đến trang đầu tiên -->
                                <Button 
                                Command="{Binding FirstPageCommand}" 
                                Style="{StaticResource MaterialDesignIconButton}" 
                                Width="36" Height="36" 
                                Margin="4,0"
                                IsEnabled="{Binding CanNavigateBackward}"
                                ToolTip="Trang đầu">
                                <materialDesign:PackIcon Kind="PageFirst" Width="24" Height="24"/>
                            </Button>
                            <!--Nút chuyển về trang trước đó-->
                            <Button 
                                Command="{Binding PreviousPageCommand}" 
                                Style="{StaticResource MaterialDesignIconButton}" 
                                Width="36" Height="36" 
                                Margin="4,0"
                                IsEnabled="{Binding CanNavigateBackward}"
                                ToolTip="Trang trước">
                                <materialDesign:PackIcon Kind="ChevronLeft" Width="24" Height="24"/>
                            </Button>
                            
                            <!-- Hiển thị chỉ số trang hiện tại -->
                            <Border 
                                Background="#E3F2FD" 
                                CornerRadius="4" 
                                Width="42" Height="42" 
                                Margin="8,0">
                                <TextBlock 
                                    Text="{Binding CurrentPage}" 
                                    HorizontalAlignment="Center" 
                                    VerticalAlignment="Center"
                                    FontWeight="Bold"
                                    FontSize="16"/>
                            </Border>
                            
                            <!-- Nút chuyển đến trang tiếp theo -->
                            <Button 
                                Command="{Binding NextPageCommand}" 
                                Style="{StaticResource MaterialDesignIconButton}" 
                                Width="36" Height="36" 
                                Margin="4,0"
                                IsEnabled="{Binding CanNavigateForward}"
                                ToolTip="Trang sau">
                                <materialDesign:PackIcon Kind="ChevronRight" Width="24" Height="24"/>
                            </Button>
                            
                            <!--Nút chuyển đến trang cuối cùng-->
                            <Button 
                                Command="{Binding LastPageCommand}" 
                                Style="{StaticResource MaterialDesignIconButton}" 
                                Width="36" Height="36" 
                                Margin="4,0"
                                IsEnabled="{Binding CanNavigateForward}"
                                ToolTip="Trang cuối">
                                <materialDesign:PackIcon Kind="PageLast" Width="24" Height="24"/>
                            </Button>
                        </StackPanel>

                        <!-- Thông tin trang 
                            Hiển thị trang hiện tại và tổng số trang theo được tính toán dựa trên số lượng hóa đơn/trang được chọn ở trên
                        -->
                        <TextBlock 
                        Grid.Column="2" 
                        Text="{Binding PageInfoText}" 
                        VerticalAlignment="Center"/>
                    </Grid>
                </Grid>
  
    </materialDesign:Card>
    
</UserControl>
